#!/bin/bash

if [ -z $1 ]; then
    echo "You have to specify the app to deodex"
    exit 1
fi

if [ -d framework/arm64 ]; then
    device_arch=arm64
else
    device_arch=arm
fi

oat2dex boot framework/$device_arch

app_dir=$(find * -type d -name "$1")

oat2dex $app_dir/oat/$device_arch/$1.odex framework/$device_arch/odex
mv $app_dir/oat/$device_arch/$1.dex $app_dir/oat/$device_arch/classes.dex
zip -gjq $app_dir/$1.apk $app_dir/oat/$device_arch/classes.dex

echo "Deodexed apk: $app_dir/$1.apk"
