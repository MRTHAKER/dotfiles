#!/usr/bin/env zsh

. $HOME/android/venv/bin/activate
. ../env.sh
export GYP_CHROMIUM_NO_ACTION=1
yes | gclient sync --with_branch_heads -R -v -r refs/remotes/origin/m52
cd src

# Build args
args='target_os="android" is_official_build=true is_debug=false is_component_build=false symbol_level=0 enable_nacl=false remove_webcore_debug_symbols=true'
if [ "$USE_CCACHE" -eq 1 ]; then
    export CCACHE_CPP2=yes
    export CCACHE_SLOPPINESS=time_macros
    args+=' cc_wrapper="ccache"'
fi
args+=' target_cpu="arm" is_clang=true'

# Setup environment
rm -rf out
. build/android/envsetup.sh

# Build
gn gen out/Default --args=$args
ninja -C out/Default swe_browser_apk
